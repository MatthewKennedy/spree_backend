<%= render partial: "spree/admin/variants/autocomplete", formats: :js %>

<%= render partial: "spree/admin/variants/autocomplete_line_items_stock", formats: :js %>

<div id="add-line-item" data-hook class="card mb-3">
  <div class="card-header">
    <h5 class="card-title"><%= Spree.t(:products) %></h5>
  </div>
  <div class="card-body">
    <div data-hook="add_product_name" class="form-group">
      <%= form_for @order, url: spree.admin_order_add_line_items_path(@order), method: :patch, data: { controller: "form-validatio" } do |f| %>
       <%= f.fields_for :line_items_attributes do |li| %>
          <div class="form-group form-floating">
            <%= li.select :variant_id, [], {}, name: 'order[line_items_attributes][][variant_id]', class: 'form-select',
                                                      placeholder: Spree.t('admin.order.search_for_a_product_or_variant'),
                                                      data: { action: 'change->form-validation#validate',
                                                      controller: 'ts--search-variant',
                                                      ts__search_variant_debug_value: true,
                                                      ts__search_variant_uri_value: '/api/v2/platform/variants',
                                                      ts__search_variant_ransack_value: ['product_name_i_cont', 'product_sku_i_cont'],
                                                      ts__search_variant_include_value: 'images,stock_items.stock_location' } %>

            <%= label_tag :variant_id, Spree.t('admin.order.products'), class: 'form-label' %>
            <%= hidden_field nil, 'order[line_items_attributes][][quantity]', value: "1"  %>
          </div>
          <%= f.submit Spree.t('admin.order.products'), class: 'btn btn-secondary', data: { form_validation_target: "submitBtn" } %>
        <% end %>
      <% end %>
    </div>

    <% if @order.line_items.empty? %>
      <div class="alert alert-warning mb-0">
        <%= Spree.t(:your_order_is_empty_add_product) %>
      </div>
    <% else %>
      <%= render partial: 'line_items', locals: { order: @order} %>
    <% end %>
  </div>
</div>
