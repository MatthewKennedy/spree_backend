<div data-hook="admin_customer_detail_form_fields">

  <div class="card mb-3" data-hook="customer_guest" <% if @order.user_id %> style="display:none;" <% end %>>
    <div class="card-header">
      <h5 class="card-title mb-0 h6">
        <%= Spree.t(:account) %>
      </h5>
    </div>

    <div class="card-body">
      <div data-hook="customer_fields" class="row">
        <div class="col-12">
          <% if @order.user_id %>
          <div class="form-floating">
            <h4><span class="badge bg-secondary"><%= @order.user.try(:email) || @order.email %></span></h4>
            <%= f.hidden_field :email, value: @order.user.try(:email) || @order.email  %>
          </div>
          <% else %>
            <div class="form-floating">
              <% if can? :edit, @order.user %>
                <%= f.email_field :email, class: 'form-control', placeholder: Spree.t(:email), required: true %>
                <%= f.label :email, raw(Spree.t(:email) + required_span_tag) %>
              <% else %>
                <p><%= @order.user.try(:email) || @order.email %></p>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

  </div>

  <div class="row">
    <div class="col-12">
      <div class="form-group ">
        <span class="form-check" data-hook="use_billing">
          <%= check_box_tag 'order[use_billing]', '1', @order.shipping_eq_billing_address?, class: 'form-check-input' %>
          <%= label_tag 'order[use_billing]', Spree.t(:use_billing_address), class: 'form-check-label' %>
        </span>
      </div>
    </div>
  </div>

  <div class="row">
    <div data-hook="bill_address_wrapper" class="col-12 col-lg-6">
      <div class="card mb-3">
        <div class="card-header">
          <h5 class="card-title mb-0 h6"><%= Spree.t(:billing_address) %></h5>
        </div>

        <div class="card-body" data-controller="form-validation">
          <% if can? :edit, @order.user %>
            <%= f.fields_for :bill_address do |ba_form| %>
              <%= render 'spree/admin/shared/address_form', f: ba_form, type: "billing" %>
            <% end %>
          <% else %>
            <%= render 'spree/admin/shared/address', address: @order.bill_address %>
          <% end %>

          <%= f.button "Validate", formaction: spree.edit_admin_order_customer_path(@order), formmethod: "get", data: { turbo_frame: :billing_country_select, form_validation_target: "submitBtn" } %>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6" data-hook="ship_address_wrapper">
      <div class="card mb-3">
        <div class="card-header">
          <h5 class="card-title mb-0 h6"><%= Spree.t(:shipping_address) %></h5>
        </div>
        <div class="card-body" data-controller="form-validation">
          <% if can? :edit, @order.user %>
            <%= f.fields_for :ship_address do |sa_form| %>
              <%= render 'spree/admin/shared/address_form', f: sa_form, type: 'shipping' %>
            <% end %>
          <% else %>
            <%= render 'spree/admin/shared/address', address: @order.ship_address %>
          <% end %>

          <%= f.button "Validate", id: 'ship_val', formaction: spree.edit_admin_order_customer_path(@order), formmethod: "get", data: { turbo_frame: :shipping_country_select, form_validation_target: "submitBtn" } %>
        </div>
      </div>
    </div>
  </div>

  <% if can? :edit, @order.user %>
    <div class="form-actions" data-hook="buttons">
      <%= button Spree.t('actions.update'), 'save.svg' %>
    </div>
  <% end %>
</div>
